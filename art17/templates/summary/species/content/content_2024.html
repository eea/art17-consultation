{% from '_macros.html' import parse_errors, reason_title, set_method_title, set_reason_title, set_extrapolation with context %}

<!-- Range  -->
<td {{ parse_errors('range_surface_area', row, qa_errors, classes='number border_left text-center') }}
    {{ set_reason_title(row.range_change_reason ) }}>
  {{ row.range_surface_area|str2num }}
</td>

{% set classes=CONCLUSION_CLASSES.get(row.conclusion_range, '') %}
<td {{ parse_errors(['conclusion_range', 'percentage_range_surface_area'],
                    row, qa_errors, classes=classes) }}>
  <span class="conclusion">{{ row.percentage_range_surface_area|str2num(0) }}</span>
</td>

<td {{ parse_errors('range_trend', row, qa_errors, classes="center text-center") }}
    {{ set_method_title(row.range_trend_method|get_method_name) }}>
  {{ row.range_trend|str2num or 'N/A' }}
</td>

<td {{ parse_errors('derived_favourable_reference_range_combined', row, qa_errors, classes="center text-center") }}>
  {{ row.derived_favourable_reference_range_combined|str2num or 'N/A' }}
</td>

<td {{ parse_errors('S_5_12_b_favourable_reference_range_predefined ', row, qa_errors, classes="center text-center") }}>
  {{ row.S_5_12_b_favourable_reference_range_predefined|str2num('') }}
</td>


<!-- Population -->

<td class="number border_left center text-center">
  {{ row.population_minimum_size|str2num }}
</td>

<td class="number center text-center">
  {{ row.population_maximum_size|str2num }}
</td>

<td {{ parse_errors('population_change_reason', row, qa_errors, classes="center text-center") }}
{{ set_reason_title(row.population_change_reason) }}>
  {% set population_size = row.population_size or 'N/A' %}
  {{ population_size|str2num }}
</td>

<td {{ parse_errors('population_size_unit', row, qa_errors, classes="center text-center") }}
{{ set_extrapolation(row.S_6_4_population_size_quality_of_extrapolation) }}>
  {{ row.population_size_unit }}
</td>

<td class="number center text-center">
  {{ row.S_6_2_e_population_size_class|str2num }}
</td>

<td class="number center text-center">
  {{ row.population_estimate_type }}
</td>

<td class="number center text-center">
  {{ row.population_method }}
</td>

{% set classes=CONCLUSION_CLASSES.get(row.conclusion_population, '') %}
<td {{ parse_errors(['conclusion_population',
                     'percentage_population_mean_size'],
                     row, qa_errors, classes=classes) }}>
  <span class="conclusion">{{ row.percentage_population_mean_size|str2num(0) }}</span>
</td>

{% set qtitle, qclasses = parse_qa_errors('row.population_trend', row, qa_errors) %}
<td {{ parse_errors('population_trend_method', row, qa_errors,  classes="number center text-center") }}
    {{ set_method_title(row.population_trend_method|get_method_name) }}>
  {{ row.population_trend|str2num or 'N/A' }}
</td>

<td class="number center text-center">
  {{ row.derived_population_size_trend_magnitude }}
</td>

<td class="number center text-center">
  {{ row.derived_favourable_reference_population_combined|str2num }}
</td>

<td class="number center text-center">
  {{ row.S_6_18_b_favourable_reference_population_predefined|str2num('') }}
</td>

<td class="number center border_right text-center">
  {{ row.complementary_favourable_population_unit }}
</td>

 
<!-- Habitat for the species -->
<td class="center text-center"
    {{ set_method_title(row.habitat_sufficiency_method|set_correct_sufficiency_occupied) }}>
  {{ row.habitat_sufficiency_occupied }}
</td>

<td class="center text-center"
    {{ set_method_title(row.S_7_2_habitat_sufficiency_method_quality|set_correct_sufficiency_occupied) }}>
  {{ row.S_7_1_b_habitat_sufficiency_occupied_quality  }}
</td>

<td class="center text-center">
  {{ row.habitat_sufficiency_unoccupied }}
</td>

{% set classes=CONCLUSION_CLASSES.get(row.conclusion_habitat, '') %}
<td {{ parse_errors('conclusion_habitat', row, qa_errors, classes=classes) }}>
  <span class="conclusion">{{ row.conclusion_habitat|str1num }}</span>
</td>

<td {{ parse_errors('habitat_trend', row, qa_errors, classes='center text-center') }}
    {{ set_method_title(row.habitat_trend_method|get_method_name) }}>
  {{ row.habitat_trend or 'N/A' }}

<!-- Future prospects -->
<td class="center border_left text-center">
  {{ row.future_range|str2num }}
</td>

<td class="center text-center">
  {{ row.future_population|str2num }}
</td>

<td class="center text-center">
  {{ row.future_habitat|str2num }}
</td>

{% set classes=CONCLUSION_CLASSES.get(row.conclusion_future, '') %}
<td {{ parse_errors('conclusion_future', row, qa_errors, classes=classes) }}>
  <span class="conclusion">{{ row.conclusion_future|str2num }}</span>
</td>

<!-- Overall assessment -->

{% set classes=CONCLUSION_CLASSES.get(row.conclusion_assessment, '') %}
<td {{ parse_errors('conclusion_assessment', row, qa_errors, classes=classes) }}>
  <span class="conclusion">{{ row.conclusion_assessment|str1num }}</span>
</td>

<td class="center text-center">{{ row.conclusion_assessment_trend|na_if_none }}</td>

{% set classes=CONCLUSION_CLASSES.get(row.conclusion_assessment_prev, '') %}
<td class="{{ classes }}">
  <span class="conclusion">{{ row.conclusion_assessment_prev|str1num }}</span>
</td>

<td class="center text-center">
  {{ row.conclusion_assessment_trend_prev }}
</td>

<td class="center text-center">{{ row.conclusion_assessment_change|na_if_none }}</td>

<td class="center border_right text-center">
  {{ row.conclusion_assessment_trend_change|str1num }}
</td>

<!-- Distribution area -->

<td class="center text-center">
  {{ row.distribution_grid_area|str2num }}
</td>

<td class="center text-center">
  {{ row.distribution_method|str2num }}
</td>

<td class="center border_right text-center">
  {{ row.percentage_distribution_grid_area|str2num(0) }}
</td>

<td class="border_right" colspan="5"></td>
